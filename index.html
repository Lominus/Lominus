<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andre AI - Chat AI Responsif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
            background-color: black;
        }
        .dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .dark .bg-white {
            background-color: #2d3748;
        }
        .dark .bg-gray-100 {
            background-color: #4a5568;
        }
        .dark .text-gray-800 {
            color: #e2e8f0;
        }
        .dark .border-gray-300 {
            border-color: #4a5568;
        }
        .dark .placeholder-gray-500::placeholder {
            color: #a0aec0;
        }
        .chat-message.ai {
            justify-content: flex-start;
        }
        .chat-message.user {
            justify-content: flex-end;
        }
        .chat-message .message-bubble {
            max-width: 80%;
            border-radius: 1.5rem;
            padding: 0.75rem 1.25rem;
            word-wrap: break-word;
        }
        /* Perubahan untuk mengatur lebar maksimum gelembung pesan pada layar yang lebih besar */
        @media (min-width: 768px) {
            .chat-message .message-bubble {
                max-width: 700px;
            }
        }
        .chat-message.ai .message-bubble {
            background-color: #e2e8f0;
            color: #2d3748;
            border-bottom-left-radius: 0;
        }
        .chat-message.user .message-bubble {
            background-color: #a0aec0;
            color: #1a202c;
            border-bottom-right-radius: 0;
        }
        .dark .chat-message.ai .message-bubble {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        .dark .chat-message.user .message-bubble {
            background-color: #a0aec0;
            color: #1a202c;
        }
        .image-preview-container {
            position: relative;
            margin-top: 0.5rem;
        }
        .image-preview {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            border: 2px solid #a0aec0;
        }
        .remove-image {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid #a0aec0;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300">

    <!-- Kontainer utama kini memenuhi seluruh layar -->
    <div class="flex flex-col w-full h-screen bg-white dark:bg-gray-800 overflow-hidden">

        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center space-x-2">
                <!-- Profil Andre AI -->
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center p-1 overflow-hidden">
                    <img src="https://placehold.co/40x40/5b84d4/ffffff?text=AI" alt="Ikon Profil AI" class="w-full h-full object-cover">
                </div>
                <h1 class="text-xl font-bold text-gray-800 dark:text-white">Andre AI</h1>
            </div>
            <div class="flex items-center space-x-2">
                <select id="modeSelector" class="p-2 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-white border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="normal">Mode AI</option>
                    <option value="bercanda">Mode Bermain</option>
                    <option value="marah">Mode Marah</option>
                </select>
                <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300">
                    <svg id="sunIcon" class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor" style="display: none;">
                        <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 00-1.06-1.06l-1.59 1.59a.75.75 0 101.06 1.06l1.59-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM15.54 18.894a.75.75 0 00-1.06-1.06l-1.59 1.59a.75.75 0 101.06 1.06l1.59-1.59zM12 18.75a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25a.75.75 0 01.75-.75zM7.106 15.54a.75.75 0 00-1.06 1.06l-1.59 1.59a.75.75 0 001.06 1.06l1.59-1.59zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3a.75.75 0 01-.75-.75zM5.518 7.106a.75.75 0 001.06-1.06L5 4.456A.75.75 0 003.94 5.518l1.578 1.588z" />
                    </svg>
                    <svg id="moonIcon" class="w-6 h-6 text-gray-500" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor" >
                        <path d="M12 21.75a9.75 9.75 0 007.5-3.35A9.75 9.75 0 018.75 4.5 9.75 9.75 0 0012 21.75z" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Chat area -->
        <div id="chatbox" class="flex-grow p-4 overflow-y-auto scroll-smooth space-y-4">
            <!-- Pesan akan ditambahkan di sini oleh JavaScript -->
            <div class="flex items-start chat-message ai">
                <div class="message-bubble bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white shadow-md">
                    <p>Halo! Saya Andre AI, asisten Anda. Ada yang bisa saya bantu?</p>
                    <span class="block text-right text-xs text-gray-500 dark:text-gray-400 mt-1">10:07 PM</span>
                </div>
            </div>
        </div>

        <!-- Input area -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <div id="imagePreviewContainer" class="image-preview-container" style="display:none;">
                <img id="imagePreview" class="image-preview" src="" alt="Image Preview">
                <button id="removeImageBtn" class="remove-image focus:outline-none">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" fill-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="flex items-center space-x-2 mt-2">
                <input type="file" id="imageInput" accept="image/*" class="hidden" />
                <button id="imageButton" class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M4 16.5l4-4 4 4 4-4 4 4" />
                        <circle cx="12" cy="7.5" r="2.5" />
                    </svg>
                </button>
                <textarea id="userInput" class="flex-grow p-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white placeholder-gray-500 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ketik pesan Anda..." rows="1"></textarea>
                <button id="sendButton" class="p-3 rounded-xl bg-blue-500 text-white hover:bg-blue-600 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Logik aplikasi
        const chatbox = document.getElementById('chatbox');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        const imageInput = document.getElementById('imageInput');
        const imageButton = document.getElementById('imageButton');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const modeSelector = document.getElementById('modeSelector');

        let isDark = localStorage.getItem('theme') === 'dark';
        let attachedImageBase64 = null;
        let currentMode = 'normal';

        // Atur tema awal
        function setTheme(isDark) {
            if (isDark) {
                document.body.classList.add('dark');
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            } else {
                document.body.classList.remove('dark');
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            }
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        setTheme(isDark);

        // Toggle tema
        themeToggle.addEventListener('click', () => {
            isDark = !isDark;
            setTheme(isDark);
        });
        
        // Ubah mode AI
        modeSelector.addEventListener('change', (event) => {
            currentMode = event.target.value;
            // Opsional: tampilkan pesan bahwa mode telah diubah
            addMessage(`Mode diubah ke ${event.target.options[event.target.selectedIndex].text}.`, 'ai');
        });

        // Tambah pesan ke chatbox
        function addMessage(text, sender, imageUrl = null) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'items-start', 'chat-message', sender === 'user' ? 'user' : 'ai');
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            let content = `<div class="message-bubble shadow-md">`;
            if (imageUrl) {
                content += `<img src="${imageUrl}" class="image-preview mb-2" alt="Uploaded Image">`;
            }
            content += `<p>${text}</p>`;
            content += `<span class="block text-right text-xs text-gray-500 dark:text-gray-400 mt-1">${timeString}</span>`;
            content += `</div>`;

            messageDiv.innerHTML = content;
            chatbox.appendChild(messageDiv);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // Auto-resize textarea
        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = userInput.scrollHeight + 'px';
        });

        // Kirim pesan
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const userText = userInput.value.trim();
            if (!userText && !attachedImageBase64) return;

            // Tampilkan pesan pengguna
            addMessage(userText || "Gambar dikirim.", 'user', attachedImageBase64);

            // Bersihkan input
            userInput.value = '';
            userInput.style.height = 'auto';
            hideImagePreview();
            userInput.focus(); 

            // Tentukan prompt berdasarkan mode AI
            let aiPrompt = "";
            switch (currentMode) {
                case 'bercanda':
                    aiPrompt = "Berikan tanggapan yang lucu, santai, dan penuh canda tawa untuk pesan ini. Jangan terlalu serius.";
                    break;
                case 'marah':
                    aiPrompt = "Berikan tanggapan yang terdengar marah, kesal, dan sedikit judes. Jawablah dengan singkat.";
                    break;
                default:
                    aiPrompt = "Silakan berikan tanggapan yang relevan dan singkat untuk pesan berikut.";
            }

            // Tampilkan pesan loading dari AI
            const loadingMessage = document.createElement('div');
            loadingMessage.innerHTML = `<div class="flex items-start chat-message ai">
                                        <div class="message-bubble bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white shadow-md">
                                            <div class="flex items-center space-x-2">
                                                <svg class="animate-spin h-5 w-5 text-gray-500 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                                <span>AI sedang memproses...</span>
                                            </div>
                                        </div>
                                    </div>`;
            chatbox.appendChild(loadingMessage);
            chatbox.scrollTop = chatbox.scrollHeight;

            try {
                const parts = [];
                if (userText) {
                    parts.push({ text: userText });
                }
                if (attachedImageBase64) {
                    parts.push({
                        inlineData: {
                            mimeType: "image/png",
                            data: attachedImageBase64
                        }
                    });
                }

                const payload = {
                    contents: [{ role: "user", parts: parts }],
                    systemInstruction: { parts: [{ text: aiPrompt }] }
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const aiResponseText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, terjadi kesalahan saat memproses permintaan Anda.";
                
                // Hapus pesan loading dan tambahkan respon AI
                chatbox.removeChild(loadingMessage);
                addMessage(aiResponseText, 'ai');

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                chatbox.removeChild(loadingMessage);
                addMessage("Maaf, terjadi kesalahan. Silakan coba lagi.", 'ai');
            }
        }

        // Logik upload gambar
        imageButton.addEventListener('click', () => {
            imageInput.click();
        });

        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => {
                    attachedImageBase64 = reader.result.split(',')[1];
                    imagePreview.src = reader.result;
                    imagePreviewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        removeImageBtn.addEventListener('click', () => {
            hideImagePreview();
        });

        function hideImagePreview() {
            attachedImageBase64 = null;
            imageInput.value = '';
            imagePreview.src = '';
            imagePreviewContainer.style.display = 'none';
        }

    </script>
</body>
</html>

